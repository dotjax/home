#!/usr/bin/env bash
set -euo pipefail

echo "=== Ollama Uninstall (official install cleanup) ==="
echo ""

echo "→ Stopping and disabling service"
sudo systemctl stop ollama || true
sudo systemctl disable ollama || true
sudo systemctl kill ollama || true
sudo systemctl reset-failed ollama || true

echo "→ Removing systemd service units"
sudo rm -f /etc/systemd/system/ollama.service || true
sudo rm -f /lib/systemd/system/ollama.service || true
sudo rm -f /usr/lib/systemd/system/ollama.service || true
sudo systemctl daemon-reload || true

echo "→ Removing binaries and symlinks"
sudo rm -f /usr/local/bin/ollama || true
sudo rm -f /usr/bin/ollama || true
sudo rm -f /opt/ollama/ollama || true

echo "→ Removing data and configs"
sudo rm -rf /var/lib/ollama || true
sudo rm -rf /etc/ollama || true
rm -rf ~/.ollama || true

echo "→ Clearing cache and temporary files"
sudo rm -rf /var/cache/ollama || true
sudo rm -rf /var/tmp/ollama || true

echo "→ Removing desktop entries and shared assets"
sudo rm -f /usr/share/applications/ollama.desktop || true
sudo rm -rf /usr/share/ollama || true

echo "→ Flushing journal logs for ollama"
sudo journalctl -u ollama --rotate || true
sudo journalctl -u ollama --vacuum-time=1s || true

echo "→ Verification"
command -v ollama >/dev/null 2>&1 && echo "WARN: ollama still in PATH" || echo "OK: ollama binary removed"
systemctl status ollama >/dev/null 2>&1 && echo "WARN: ollama service still present" || echo "OK: ollama service removed"

echo ""
echo "=== Uninstall complete ==="
